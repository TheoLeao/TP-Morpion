<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP - Morpion</title>
    <script src="js/script.js"></script>
    <style>
        .jeu {
            display: flex;
        }

        .jeu div {
            width: 100%;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="consigne">
            <h4>Consigne: TP : Réalisation d'un jeu de morpion 5x5. Pour gagner il faudra aligner quatre carrés
                ou quatre ronds.</h4>
            <ul>
                <li> 1° Pour jouer, il faudra impérativement que les noms des deux joueurs soient saisis.</li>
                <li>
                    2° Les joueurs jouent alternativement. Le symbole <<<<< indique qui doit jouer. </li>
                <li>
                    3° Si un joueur aligne 4 ronds ou 4 carrés, un message Gagné apparait à côté de son
                    nom, son score augmente de 1, le jeu est bloqué et deux boutons apparaissent 'Rejouer" et "Nouvelle
                    partie".
                </li>

                <li>
                    4° En cliquant sur Rejouer les deux même joueurs peuvent refaire une partie (le jeu
                    précédent est effacé et les deux boutons sont masqués)
                </li>
                <li>
                    5° En cliquant sur Nouvelle partie les noms et les scores sont effacés. Les deux
                    boutons sont masqués.
                </li>
                <li>
                    6° Chaque fois qu'un score évolue, les noms et les scores sont enregistrés en
                    localStorage.
                </li>
                <li>
                    7° Au démarrage d'une partie dans une nouvelle fenêtre du navigateur, si deux noms
                    et deux scores sont enregistrés dans le localStorage, ils sont alors affichés avec les
                    deux boutons 'Rejouer" et "Nouvelle partie".
                </li>
                <li>
                    8° Lorsque 25 coups ont été joués sans réussir à aligner 4 ronds ou 4 carrés, le
                    message "Partie nulle" s'affiche, la partie est bloquée et deux boutons 'Rejouer" et
                    "Nouvelle partie" sont rendus visibles.
                </li>
            </ul>
        </div>
        <div class="jeu">
            <div>
                <canvas id="canvasJeu" width="500" height="500"></canvas>
            </div>
            <div class="infoJeu">
                <h2>Joueurs</h2>
                <div>
                    <input id="nomJoueur1" type="text" placeholder="Nom joueur 1">
                    <input id="nomJoueur2" type="text" placeholder="Nom joueur 2">
                </div>


                <button disabled>Rejouer</button>
                <button id="btnNouvellePartie">Nouvelle partie</button>
            </div>



        </div>
    </div>
</body>
<script src="js/script.js"></script>
<script>
    //Joueurs
    let nomJoueur1 = document.querySelector('#nomJoueur1');
    let nomJoueur2 = document.querySelector('#nomJoueur2');

    //Canvas
    var canvas = document.querySelector('#canvasJeu');
    var width = canvas.width = 500;
    var height = canvas.height = 500;
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = `rgb(248,241,241)`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);


    //Fonctions géomotrie
    function drawX(originX, originY, size) {
        padding = 10;
        ctx.beginPath(); // Début du chemin
        ctx.moveTo(originX, originY); // Le tracé part du point 50,50
        ctx.lineTo(originX + size, originY + size); // Un segment est ajouté vers 200,200
        ctx.moveTo(originX + size, originY); // Puis on saute jusqu'à 200,50
        ctx.lineTo(originX, originY + size); // Puis on trace jusqu'à 50,200
        ctx.lineWidth = 7;
        ctx.strokeStyle = '#3FA7D6';
        ctx.lineCap = 'round';
        ctx.stroke();

    }
    function drawCircle(originX, originY, size) {
        ctx.beginPath();
        ctx.lineWidth = "7";
        ctx.strokeStyle = "#EE6352"
        ctx.arc(originX + size / 2, originY + size / 2, size / 2 - 5, 0, 2 * Math.PI);
        ctx.stroke();
    }
    function drawRect(originX, originY, width, height, fillColor) {
        ctx.beginPath();
        ctx.strokeStyle = "#FFFFFF";
        ctx.lineWidth = "1";
        ctx.rect(originX, originY, width, height);
        ctx.stroke();

    }
    function drawLimit(canvas, nombreLigne, nombreColonne) {
        if (nombreLigne != nombreColonne) return (error('Le nombre de ligne n\'est pas égale au nombre de colonne'));;
        //Récuperer taille du canvas
        canvasWidth = canvas.width;
        canvasHeight = canvas.height;
        //Récuperer taille des cases
        caseWidth = canvasWidth / nombreColonne;
        caseHeight = canvasHeight / nombreLigne;

        //Tracer les lignes
        pair = true;
        //Chaque ligne
        for (i_line = 0; i_line <= nombreLigne; i_line++) {
            //Chaque case
            //console.log(`line ${i_line}`)
            for (i_case = 0; i_case < nombreColonne; i_case++) {
                if (pair) {
                    //console.log(`--case ${i_case}`);
                    drawRect(caseWidth * i_case, caseWidth * i_line, caseWidth, caseHeight, '#F9FAFC');
                    //drawX(caseWidth * i_case, caseHeight * i_line, caseWidth); //Test dessiné une croix 1 fois sur 2
                    pair = false;
                }
                else {
                    //console.log(`--case ${i_case}`);
                    drawRect(caseWidth * i_case, caseWidth * i_line, caseWidth, caseHeight, '#F4F9FF');
                    //drawCircle(caseWidth * i_case, caseHeight * i_line, caseWidth); //Test dessiné un cercle 1 fois sur 2
                    pair = true;
                }

            }
        }

    }
    function createMatrice(nombreLigne, nombreColonne) {
        matrice = Array.from(
            { length: nombreColonne }, () => Array.from(
                { length: nombreLigne }, () => ('')
            )
        )

    }
    function casePlayed(caseMatrice) {
        if (!caseMatrice == '') return true;
        return false;
    }
    function coupGagnantHorizontal(nombreGagnant, coup) {
        colonne = coup[0];
        ligne = coup[1];
        aVerifDroite = aVerifGauche = 0;
        countColonne1 = countColonne2 = colonne;
        valideADroite = valideAGauche = 0;

        //Récupérer le nombre de case à vérifier à droite
        while (countColonne1 < matrice[0].length - 1) {
            countColonne1++;
            aVerifDroite++;
            //console.log('+1')
        }
        //Récupérer le nombre de case à vérifier à gauche
        while (countColonne2 > 0) {
            countColonne2--;
            aVerifGauche++;
        }
        console.log(`à verif Gauche: ${aVerifGauche} | à verif Droite: ${aVerifDroite}`);
        //Vérifier les cases à vérifier à droite 
        for (i = 1; i <= aVerifDroite; i++) {
            console.log(`vérification case ${colonne + i}:`)
            //Si la case suivante n'est pas valide
            if (matrice[ligne][colonne + i] !== 'X') {
                console.log('pasegalX');
                //Arrêter de parcourir
                break;
            }
            //Sinon, ajouter 1 à valideADroite
            else {
                console.log('egalX');
                valideADroite++;
            }
        }
        //Vérifier les cases à vérifier à gauche 
        for (i = 1; i <= aVerifGauche; i++) {
            console.log(`vérification case ${colonne + i}:`)
            //Si la case suivante n'est pas valide
            if (matrice[ligne][colonne - i] !== 'X') {
                console.log('pasegalX');
                //Arrêter de parcourir
                break;
            }
            //Sinon, ajouter 1 à valideADroite
            else {
                console.log('egalX');
                valideAGauche++;
            }
        }

        if (valideAGauche + valideADroite == nombreGagnant - 1) {
            return true;
        }
        console.log(`colonne: ${colonne} limit:${matrice[0].length - 1} | caseAVerifGauche: ${aVerifGauche} | case valide Gauche: ${valideAGauche} caseAVerifDroite = ${aVerifDroite} | valideADroite: ${valideADroite}`)
    }
    function coupGagnant(nombreGagnant, coup) {
        if (coupGagnantHorizontal(nombreGagnant, coup)) return true;
        return false;
    }
    nombreLigne = 5;
    nombreColonne = 5;
    tour = 1;

    createMatrice(5, 5);
    console.log(matrice[0].length)
    canvas.addEventListener('click', function (e) {
        //Récupération des coordonnées de la sourie
        let x = Math.ceil(e.offsetX / 100) * 100 - 100;
        let y = Math.ceil(e.offsetY / 100) * 100 - 100;
        console.log(`${x / 100} et ${y / 100}`);
        //Vérifier si la case a été joué | 
        ligne = y / 100;
        colonne = x / 100;
        if (!casePlayed(matrice[ligne][colonne])) {
            //Jouer le tour
            if (tour == 1) {
                matrice[ligne][colonne] = 'X'; //Inverser pour pouvoir visualiser dans la matrice
                drawX(x, y, caseWidth, caseHeight)
                if (coupGagnant(4, [colonne, ligne])) {
                    tour = 0;
                    alert('Le joueur 1 a gagné');
                }
                else {
                    tour = 2;
                }
                //ifCoupGagnant tour = 0 sinon tour = 2

            }
            else if (tour == 2) {
                matrice[ligne][colonne] = 'O'; //Inverser pour pouvoir visualiser dans la matrice
                drawCircle(x, y, caseWidth);
                tour = 1;
            }
        }
        console.log(matrice);
    });



    //Case {0:0}

    //Case {1:0}

    drawLimit(canvas, 5, 5);

    //drawRect(50, 50, 102, 102, 'blue');


    //Ecouteurs d'évenements
    function nouvellePartie() {


    }

</script>

</html>